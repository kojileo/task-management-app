# E2Eテスト（Playwright）

このディレクトリにはタスク管理アプリケーションのE2E（エンドツーエンド）テスト関連ファイルが格納されています。E2Eテストには[Playwright](https://playwright.dev/)を使用しています。

## ディレクトリ構成

```
e2e/
 ├── tests/                       # テストスクリプト
 │   ├── task-management.test.ts   # タスク管理の基本機能テスト
 │   └── simple.test.ts            # シンプルな動作確認テスト
 ├── playwright.config.ts         # Playwright設定ファイル
 ├── package.json                 # 依存関係とスクリプト定義
 ├── test-results/                # テスト結果（スクリーンショット等）
 ├── playwright-report/           # HTMLレポート
 └── aitest/                      # AIエージェントによるE2Eテスト
```

## 主要テストシナリオ

`task-management.test.ts`では、以下の一連のフローをテストしています：

1. **タスク作成**: 新規タスクの作成と検証
2. **タスク編集**: 作成したタスクの内容更新
3. **ステータス変更**: タスクのステータス変更（未着手→進行中→完了）
4. **タスク削除**: 完了したタスクの削除

このテストは実際のユーザー操作を模倣し、フロントエンドとバックエンドの統合をエンドツーエンドで検証します。

## 必要条件

- Node.js 16以上
- タスク管理アプリのフロントエンドおよびバックエンドが動作していること

## セットアップ

```bash
# 依存関係のインストール
npm install

# Playwrightブラウザのインストール
npx playwright install
```

## テスト実行方法

```bash
# すべてのテストを実行
npm test

# UIモードでテストを実行（対話型）
npm run test:ui

# ヘッドレスモードで特定のテストを実行
npm run test:task-management

# デバッグモードでテストを実行
npm run test:debug

# ブラウザを表示してテストを実行
npm run test:headed
```

## テスト結果の確認

テスト実行後、以下の方法で結果を確認できます：

```bash
# HTMLレポートを開く
npm run report
```

また、テスト実行中のスクリーンショットとビデオは `test-results` ディレクトリに保存されます。

## Playwright設定

`playwright.config.ts`では以下の設定を行っています：

- **ブラウザ**: Chrome（デフォルト）、Firefox、Safari、Edgeも設定可能
- **モバイル対応**: モバイルブラウザでのテストも設定可能
- **タイムアウト**: アクション、ナビゲーション、期待値の待機時間
- **リトライ**: テスト失敗時の再試行回数（CI環境では2回）
- **レポート**: HTML、JSON、コンソール出力
- **スクリーンショット**: テスト失敗時に自動取得
- **ビデオ**: 初回リトライ時に録画

## トラブルシューティング

- **テスト失敗時**: `test-results`ディレクトリのスクリーンショットを確認
- **セレクタの問題**: テスト内の複数のフォールバックメカニズムを確認
- **タイミングの問題**: `expect`内のタイムアウト値を調整

## カスタマイズ

新しいテストを追加する場合は、以下の手順で行います：

1. `tests`ディレクトリに新しいテストファイルを作成
2. テストシナリオを記述
3. `package.json`の`scripts`セクションにテスト実行コマンドを追加

## AIエージェントによるE2Eテスト

`aitest`ディレクトリには、AIエージェントを活用した高度なE2Eテストが含まれています。これらはPlaywright Model Composition Pattern（MCP）を使用して実装されています。

### AIテストの特徴

- **インテリジェントなテスト**: 従来のE2Eテストよりも柔軟にUIの変更に対応
- **自己修復能力**: セレクタが変更されても自動的に適応
- **自然言語指示**: 自然言語でテスト指示を記述可能

### AIテスト実行方法

```bash
# 必要な依存関係をインストール
cd aitest
pip install -r requirements.txt

# 環境設定
# 1. .envファイルを作成しAPIキーを設定
# 2. mcp_config.jsonにMCPサーバー設定を記述

# AIエージェントテストを実行
python praywrite_mcp_langchain_tools.py
```

### AIテスト活用のベストプラクティス

1. 頻繁に変更されるUIコンポーネントのテストに使用
2. 複雑なユーザーフローの検証に活用
3. 従来のE2Eテストと組み合わせて使用し、相互補完する
4. 自然言語でのテストドキュメント自動生成に活用

AI駆動テストと従来のE2Eテストを組み合わせることで、より堅牢で持続可能なテスト戦略を実現できます。
